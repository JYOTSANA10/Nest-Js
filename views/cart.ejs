<!DOCTYPE html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<style>
    .your_shopping_bag-box {
            background: #FFFFFF;
            box-shadow: 5px 5px 10px #00000029;
            border: 1px solid #DDDDDD;
            padding: 20px 25px;
            position: relative;
            ;
            right: -150px;
            top: 100%;
            margin-top: 25px;
            width: 100%;
            max-width: 380px;
        }

        .your_shopping_bag-box h3 {
            font-size: 24px;
            font-weight: 700;
            color: #180c34;
            line-height: inherit;
            text-align: center;
            margin-bottom: 22px;
            margin-top: 10px;
        }

        .your_shopping_bag-box ul.shopping_detail {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_iteam {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #EEEEEE;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_iteam:first-child {
            border-top: 1px solid #EEEEEE;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_iteam .shopping_detail_iteam--img {
            display: block;
            position: relative;
            max-width: 100px;
            width: 100%;
            height: 100px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16);
            border-radius: 5px;
            border: 1px solid #4f2982;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_iteam .shopping_detail_iteam--img img {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            object-fit: cover;
            width: 100%;
            height: 100%;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_iteam .shopping_detail_iteam--col {
            margin-left: -100px;
            width: 100%;
            padding-left: 115px;
            position: relative;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_iteam .close_iteam {
            position: absolute;
            right: 10px;
            top: 5px;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_iteam .close_iteam a {
            color: #180c34;
            text-decoration: none;
            display: flex;
            transition: all 0.4s ease-in-out;
            line-height: 10px;
            font-size: 20px;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_iteam .close_iteam a:hover {
            color: #e56db1;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_iteam h4 {
            font-size: 14px;
            font-weight: 900;
            color: #180c34;
            line-height: inherit;
            margin-bottom: 8px;
            padding-right: 30px;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_iteam .shopping_detail_value_price {
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_iteam .shopping_detail_value {
            display: flex;
            padding-right: 30px;
            position: relative;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_iteam .shopping_detail_value:before {
            content: "";
            position: absolute;
            right: 10px;
            top: 50%;
            width: 4px;
            height: 4px;
            border-radius: 2px;
            margin-top: -2px;
            background-color: #B1B1B1;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_iteam .shopping_detail_value span {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 22px;
            height: 22px;
            border: 1px solid #DDDDDD;
            font-size: 12px;
            color: #B1B1B1;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_iteam .shopping_detail_price span {
            display: flex;
            font-size: 14px;
            font-weight: 700;
            color: #180c34;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_total {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 25px;
            border-bottom: 1px solid #EEEEEE;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_total .shopping_detail_total--title,
        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_total .shopping_detail_total--price {
            display: flex;
            font-size: 14px;
            font-weight: 900;
            color: #180c34;
        }

        .your_shopping_bag-box ul.shopping_detail li.shopping_detail_total .shopping_detail_total--price {
            font-weight: 700;
        }

        .your_shopping_bag-box .shopping_detail-btns {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .your_shopping_bag-box .shopping_detail-btns .ui-btn {
            margin-bottom: 15px;
            min-width: 230px;
            padding-left: 20px;
            padding-right: 20px;
            height: 42px;
            text-decoration: none;
            color: black;
        }
        /* .shopping_detail_total--title{} */
        /* a{
            text-decoration: none;
            color: black;
            
        } */
        .qty-box{display:flex;flex-direction:row;align-items:center;}
        .qty-box .qty-label{font-size:20px;line-height:28px;font-weight:700;letter-spacing:0.25px;color:#333333;margin-right:10px;}
        .detail-qty{display:flex;align-items:center;}
        .detail-qty a{width:23px;height:19px;color:#ffffff;background-color:#333333;border-radius:15px;line-height:23px;text-align:center;text-decoration:none;display:flex;align-items:center;justify-content:center;font-size:34px;font-family:cursive;padding-bottom:5px;}
        .detail-qty .qty-val{width:50px;height:30px;text-align:center;border:1px solid #333333;border-radius:0;margin:0 8px;}
        .qty-down, .qty-up,.close_iteam{
            cursor: pointer;
        }
</style>
</head>
<body>
    <div id="your_shopping_bag" class="your_shopping_bag-box">
        <h3>Your shopping bag</h3><% var total=0 %>
        <ul class="shopping_detail" >
            <div id="change">
            <%for(var i=0; i<show_cart.length; i++) {  %>
            <li class="shopping_detail_iteam">
                <div class="shopping_detail_iteam--img">
                    <img src="/uploads/<%=show_cart[i].product.image%>" >
                </div>
                <div class="shopping_detail_iteam--col">
                    <div class="shopping_detail_title">
                        <h4><%=show_cart[i].product.name%></h4>
                    </div>
                    <div class="shopping_detail_value_price">
                        <div class="shopping_detail_value">
                           
                            <div class="qty-box">
                               
                                <div class="detail-qty info-qty">
                                  <span class="qty-down" onclick="minus('<%=show_cart[i].id%>')">&#8722;</span>
                                  <input
                                    type="text"
                                    data-step="1"
                                    min="1"
                                    max="10"
                                    name="quantity"
                                    value="<%=show_cart[i].number_of_items%>"
                                    title="Qty"
                                    class="qty-val"
                                    size="4"
                                  >
                                  <span class="qty-up" onclick="plus('<%=show_cart[i].id %>')">&#43;</span>
                                </div>
                              </div>
                        </div>
                        <div class="shopping_detail_price">
                            <span><%=show_cart[i].product.price%></span>
                        </div>
                    </div>
                    <div class="close_iteam">
                        <span onclick="delete_product('<%=show_cart[i].id%>')">&#215;</span>
                    </div>
                </div>
            </li>
            <% total=total+(show_cart[i].product.price*show_cart[i].number_of_items) %>
            <% } %>
        </div>

            
            <li class="shopping_detail_total" >
                <div class="shopping_detail_total--title">
                    TOTAL
                </div>
                <div class="shopping_detail_total--price" id="change2">
                    <%= total %>
                </div>
            </li>
           
           

            

        </ul>
        <div class="shopping_detail-btns">
            <button class="ui-btn"><a href="/user-dashboard/product" class="ui-btn">Go to Product-Page </a></button>
            <%if(total==0) { %>
            <button class="ui-btn" onclick="placeOrder()" name="add-to-cart" onclick="placeOrder()" >Buy Now</a></button>
            <%}else{%>
                <button class="ui-btn"><a href="/user-dashboard/confirm" class="ui-btn" name="add-to-cart" >Buy Now</a></button>

            <%}%>
        </div>
    </div>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <script>
        function placeOrder(){
           
                    console.log("If");
	                swal("Cart is empty!");

                
        }



        function delete_product(id){
            var set='';
            var total=0
            
            axios.put(`/carts/delete-item?id=${id}`).then(function (response) { 
              
                for(var i=0;i<response.data.length;i++){
                    total=total+(response.data[i].product.price*response.data[i].number_of_items)
                    set+=`<li class="shopping_detail_iteam"> <div class="shopping_detail_iteam--img"> <img src="/uploads/${response.data[i].product.image}" > </div> <div class="shopping_detail_iteam--col"> <div class="shopping_detail_title"> <h4>${response.data[i].product.name}</h4> </div> <div class="shopping_detail_value_price"> <div class="shopping_detail_value"> <div class="qty-box"> <div class="detail-qty info-qty"> <span class="qty-down" onclick="minus('${response.data[i].id}')">−</span> <input type="text" data-step="1" min="1" max="10" name="quantity" value="${response.data[i].number_of_items}" title="Qty" class="qty-val" size="4" > <span class="qty-up" onclick="plus('${response.data[i].id }')">+</span> </div> </div> </div> <div class="shopping_detail_price"> <span>${response.data[i].product.price}</span> </div> </div> <div class="close_iteam"> <span onclick="delete_product('${response.data[i].id}')">×</span> </div> </div> </li>`
                   
                }
                console.log(total);
                    document.getElementById("change").innerHTML=set;
                    document.getElementById("change2").innerHTML=total;

            });
            
            
        }

        function minus(id){
            console.log(id);
            var total=0
            var set='';
            axios.put(`/carts/minus-item?id=${id}`).then(function (response) { 
                console.log(response);

                for(var i=0;i<response.data.length;i++){
                    total=total+(response.data[i].product.price*response.data[i].number_of_items)

                    set+=`<li class="shopping_detail_iteam"> <div class="shopping_detail_iteam--img"> <img src="/uploads/${response.data[i].product.image}" > </div> <div class="shopping_detail_iteam--col"> <div class="shopping_detail_title"> <h4>${response.data[i].product.name}</h4> </div> <div class="shopping_detail_value_price"> <div class="shopping_detail_value"> <div class="qty-box"> <div class="detail-qty info-qty"> <span class="qty-down" onclick="minus('${response.data[i].id}')">−</span> <input type="text" data-step="1" min="1" max="10" name="quantity" value="${response.data[i].number_of_items}" title="Qty" class="qty-val" size="4" > <span class="qty-up" onclick="plus('${response.data[i].id }')">+</span> </div> </div> </div> <div class="shopping_detail_price"> <span>${response.data[i].product.price}</span> </div> </div> <div class="close_iteam"> <span onclick="delete_product('${response.data[i].id}')">×</span> </div> </div> </li>`
                }
                    document.getElementById("change").innerHTML=set;
                    document.getElementById("change2").innerHTML=total;

                });


           
            
        }

        function plus(id){
            console.log(id);

            var set='';
            var total=0
            axios.put(`/carts/plus-item?id=${id}`).then(function (response) { 
                console.log(response);
                for(var i=0;i<response.data.length;i++){
                    total=total+(response.data[i].product.price*response.data[i].number_of_items)

                    set+=`<li class="shopping_detail_iteam"> <div class="shopping_detail_iteam--img"> <img src="/uploads/${response.data[i].product.image}" > </div> <div class="shopping_detail_iteam--col"> <div class="shopping_detail_title"> <h4>${response.data[i].product.name}</h4> </div> <div class="shopping_detail_value_price"> <div class="shopping_detail_value"> <div class="qty-box"> <div class="detail-qty info-qty"> <span class="qty-down" onclick="minus('${response.data[i].id}')">−</span> <input type="text" data-step="1" min="1" max="10" name="quantity" value="${response.data[i].number_of_items}" title="Qty" class="qty-val" size="4" > <span class="qty-up" onclick="plus('${response.data[i].id }')">+</span> </div> </div> </div> <div class="shopping_detail_price"> <span>${response.data[i].product.price}</span> </div> </div> <div class="close_iteam"> <span onclick="delete_product('${response.data[i].id}')">×</span> </div> </div> </li>`
                }
                    document.getElementById("change").innerHTML=set;
                    document.getElementById("change2").innerHTML=total;
                    
            });
           

            // fetch(`/carts/plus-item?id=${id}`,{
            //     method:'PUT',
            //     headers: {
            //     "Accept": "application/json",
            //     "Content-Type": "application/json",
            //     }
            // }).then((res) => {
            //     console.log(res);
            //     window.location.reload();
            // })
        }
    </script>
</body>
</html>